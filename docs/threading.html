

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>threading &mdash; Patrick&#39;s Docs alpha documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/my_theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/my_theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/dark_mode_css/general.css" type="text/css" />
  <link rel="stylesheet" href="_static/dark_mode_css/dark.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/dark_mode_js/default_dark.js"></script>
        <script src="_static/dark_mode_js/theme_switcher.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Patrick's Docs
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="ansible.html">ansible</a></li>
<li class="toctree-l1"><a class="reference internal" href="apidoc/modules.html">becode</a></li>
<li class="toctree-l1"><a class="reference internal" href="bash.html">bash</a></li>
<li class="toctree-l1"><a class="reference internal" href="git.html">GIT</a></li>
<li class="toctree-l1"><a class="reference internal" href="links.html">Links</a></li>
<li class="toctree-l1"><a class="reference internal" href="python.html">python</a></li>
<li class="toctree-l1"><a class="reference internal" href="techtalk/main.html">techtalks</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Patrick's Docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>threading</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/threading.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="threading">
<h1>threading<a class="headerlink" href="#threading" title="Permalink to this headline">¶</a></h1>
<div class="section" id="non-blocking">
<h2>non-blocking<a class="headerlink" href="#non-blocking" title="Permalink to this headline">¶</a></h2>
<div class="section" id="first-example">
<h3>first example<a class="headerlink" href="#first-example" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">threading</span> <span class="kn">import</span> <span class="n">Thread</span>
<span class="kn">import</span> <span class="nn">time</span>


<span class="k">class</span> <span class="nc">ThreadFunction</span><span class="p">(</span><span class="n">Thread</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">Thread</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Thread </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: starting&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Thread </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: finishing&quot;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="n">thread</span> <span class="o">=</span> <span class="n">ThreadFunction</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Thread 0: starting</span>
<span class="sd">Thread 1: starting</span>
<span class="sd">Thread 2: starting</span>
<span class="sd">Thread 3: starting</span>
<span class="sd">Thread 4: starting</span>
<span class="sd">Thread 2: finishingThread 0: finishingThread 1: finishing</span>


<span class="sd">Thread 3: finishing</span>
<span class="sd">Thread 4: finishing</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>each iteration runs in parallel and is executed at the same time. So the final script will only last 2 seconds in total since the code is not blocking.</p>
<p>Parallel programming can be very convenient, but it also has its pitfalls. We will now look at some of them and the methods that exist to avoid them.</p>
</div>
</div>
<div class="section" id="thread-synchronization">
<h2>thread synchronization<a class="headerlink" href="#thread-synchronization" title="Permalink to this headline">¶</a></h2>
<p>Programming multiple instruction streams brings its share of difficulties. At first glance, it seems very convenient to have several parts of our code running at the same time. During a task that may take a long time to run (perhaps downloading information from a website) we can do something else, not just wait for the resource to be downloaded.</p>
<p>But development can be proportionately more complicated. You have to keep in mind that different instruction streams can be advanced to different points at a given time.</p>
<div class="section" id="example">
<h3>example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyThread</span><span class="p">(</span><span class="n">Thread</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="n">Thread</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;threads.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

<span class="n">thread_1</span> <span class="o">=</span> <span class="n">MyThread</span><span class="p">(</span><span class="s2">&quot;My First thread! &quot;</span><span class="p">)</span>
<span class="n">thread_2</span> <span class="o">=</span> <span class="n">MyThread</span><span class="p">(</span><span class="s2">&quot;My Second thread! &quot;</span><span class="p">)</span>
<span class="n">thread_3</span> <span class="o">=</span> <span class="n">MyThread</span><span class="p">(</span><span class="s2">&quot;My third thread! &quot;</span><span class="p">)</span>
<span class="n">thread_4</span> <span class="o">=</span> <span class="n">MyThread</span><span class="p">(</span><span class="s2">&quot;My fourth thread! &quot;</span><span class="p">)</span>

<span class="n">thread_1</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="n">thread_2</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="n">thread_3</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="n">thread_4</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;threads.txt&quot;</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="c1"># My Second thread! My First thread! My third thread! My 4e thread!</span>
</pre></div>
</div>
</div>
<div class="section" id="lock">
<h3>lock<a class="headerlink" href="#lock" title="Permalink to this headline">¶</a></h3>
<p>There are several ways to “synchronize” our threads, i.e. to make some of the code only run if no one is using the shared resource. The simplest synchronization mechanism is the lock.</p>
<p>It is an object proposed by <cite>threading</cite> that is extremely simple to use: at the beginning of our instructions that use our shared resource, we tell the lock to block for the other threads. If another thread wants to use this resource, it must wait until it is released.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">threading</span> <span class="kn">import</span> <span class="n">Thread</span><span class="p">,</span> <span class="n">RLock</span>

<span class="n">lock</span> <span class="o">=</span> <span class="n">RLock</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">SyncThread</span><span class="p">(</span><span class="n">Thread</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="n">Thread</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">lock</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;synch_thread.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

<span class="n">thread_1</span> <span class="o">=</span> <span class="n">SyncThread</span><span class="p">(</span><span class="s2">&quot;Thread 1 /&quot;</span><span class="p">)</span>
<span class="n">thread_2</span> <span class="o">=</span> <span class="n">SyncThread</span><span class="p">(</span><span class="s2">&quot;Thread 2 /&quot;</span><span class="p">)</span>
<span class="n">thread_3</span> <span class="o">=</span> <span class="n">SyncThread</span><span class="p">(</span><span class="s2">&quot;Thread 3 /&quot;</span><span class="p">)</span>
<span class="n">thread_4</span> <span class="o">=</span> <span class="n">SyncThread</span><span class="p">(</span><span class="s2">&quot;Thread 4 /&quot;</span><span class="p">)</span>

<span class="n">thread_1</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="n">thread_2</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="n">thread_3</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="n">thread_4</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<ul class="simple">
<li><p>We import <cite>RLock</cite> from the threading module</p></li>
<li><p>We create a lock that we put into our <cite>lock</cite> variable</p></li>
<li><p>In our <cite>run</cite> method, we lock part of our thread.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">threading</span> <span class="kn">import</span> <span class="n">Thread</span><span class="p">,</span> <span class="n">RLock</span>

<span class="n">lock</span> <span class="o">=</span> <span class="n">RLock</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">SyncThread</span><span class="p">(</span><span class="n">Thread</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="n">Thread</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">lock</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sync_thread.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">thread_1</span> <span class="o">=</span> <span class="n">SyncThread</span><span class="p">(</span><span class="s2">&quot;Thread 1 /&quot;</span><span class="p">)</span>
    <span class="n">thread_2</span> <span class="o">=</span> <span class="n">SyncThread</span><span class="p">(</span><span class="s2">&quot;Thread 2 /&quot;</span><span class="p">)</span>
    <span class="n">thread_3</span> <span class="o">=</span> <span class="n">SyncThread</span><span class="p">(</span><span class="s2">&quot;Thread 3 /&quot;</span><span class="p">)</span>
    <span class="n">thread_4</span> <span class="o">=</span> <span class="n">SyncThread</span><span class="p">(</span><span class="s2">&quot;Thread 4 /&quot;</span><span class="p">)</span>

    <span class="n">thread_1</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">thread_2</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">thread_3</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">thread_4</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;sync_thread.txt&quot;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="c1"># thread order will always be the same</span>
    <span class="c1"># Thread 1 /</span>
    <span class="c1"># Thread 2 /</span>
    <span class="c1"># Thread 3 /</span>
    <span class="c1"># Thread 4 /</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Patrick Brunswyck.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>