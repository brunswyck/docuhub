

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>IPython Directive &mdash; Patrick&#39;s Docs alpha documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/my_theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/my_theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/plot_directive.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery-dataframe.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery-rendered-html.css" type="text/css" />
  <link rel="stylesheet" href="../_static/dark_mode_css/general.css" type="text/css" />
  <link rel="stylesheet" href="../_static/dark_mode_css/dark.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/dark_mode_js/default_dark.js"></script>
        <script src="../_static/dark_mode_js/theme_switcher.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Sphinx cheat sheet" href="cheatsheet.html" />
    <link rel="prev" title="Sphinx extensions for embedded plots, math and more" href="extensions.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Patrick's Docs
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../ansible.html">code plot graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ansible.html#ansible">ansible</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bash.html">bash</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cheats/main.html">cheatsheets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../git.html">GIT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../links.html">links</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python.html">python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../techtalk/main.html">techtalks</a></li>
<li class="toctree-l1"><a class="reference internal" href="extensions.html">Sphinx extensions for embedded plots, math and more</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">IPython Directive</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#pseudo-decorators">Pseudo-Decorators</a></li>
<li class="toctree-l2"><a class="reference internal" href="#enabling-ipython-directive">Enabling IPython Directive</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sphinx-source-for-this-tutorial">Sphinx source for this tutorial</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="cheatsheet.html">Sphinx cheat sheet</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Patrick's Docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">&lt;no title&gt;</a> &raquo;</li>
        
      <li>IPython Directive</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/sampledoc/ipython_directive.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="ipython-directive">
<span id="id1"></span><h1>IPython Directive<a class="headerlink" href="#ipython-directive" title="Permalink to this headline">¶</a></h1>
<p>The IPython directive is a stateful IPython shell for embedding in
Sphinx documents.  It knows about standard IPython prompts, and
extracts the input and output lines.  These prompts will be renumbered
starting at <code class="docutils literal notranslate"><span class="pre">1</span></code>.  The inputs will be fed to an embedded IPython
interpreter and the outputs from that interpreter will be inserted as
well.  For example, code blocks like the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">..</span> <span class="n">ipython</span><span class="p">::</span>

   <span class="n">In</span> <span class="p">[</span><span class="mi">136</span><span class="p">]:</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">2</span>

   <span class="n">In</span> <span class="p">[</span><span class="mi">137</span><span class="p">]:</span> <span class="n">x</span><span class="o">**</span><span class="mi">3</span>
   <span class="n">Out</span><span class="p">[</span><span class="mi">137</span><span class="p">]:</span> <span class="mi">8</span>
</pre></div>
</div>
<p>will be rendered as</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="n">x</span> <span class="o">=</span> <span class="mi">2</span>

<span class="gp">In [2]: </span><span class="n">x</span><span class="o">**</span><span class="mi">3</span>
<span class="gh">Out[2]: </span><span class="go">8</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This tutorial should be read side-by-side with the Sphinx source
for this document (see <a class="reference internal" href="#ipython-literal"><span class="std std-ref">Sphinx source for this tutorial</span></a>) because otherwise
you will see only the rendered output and not the code that
generated it.  Excepting the example above, we will not in general
be showing the literal reST in this document that generates the
rendered output.</p>
</div>
<p>The state from previous sessions is stored, and standard error is
trapped.  At doc build time, IPython’s output and std err will be
inserted, and prompts will be renumbered.  So the prompt below should
be renumbered in the rendered docs, and pick up where the block above
left off.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [3]: </span><span class="n">z</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">3</span>  <span class="c1"># x is recalled from previous block</span>

<span class="gp">In [4]: </span><span class="n">z</span>
<span class="gh">Out[4]: </span><span class="go">6</span>

<span class="gp">In [5]: </span><span class="nb">print</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<span class="go">6</span>

<span class="gp">In [6]: </span><span class="n">q</span> <span class="o">=</span> <span class="n">z</span>
</pre></div>
</div>
<p>The embedded interpreter supports some limited markup.  For example,
you can put comments in your IPython sessions, which are reported
verbatim.  There are some handy “pseudo-decorators” that let you
doctest the output.  The inputs are fed to an embedded IPython
session and the outputs from the IPython session are inserted into
your doc.  If the output in your doc and in the IPython session don’t
match on a doctest assertion, an error will be raised</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [7]: </span><span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;hello world&#39;</span>

<span class="go"># this will raise an error if the IPython output is different</span>
<span class="gp">In [8]: </span><span class="n">x</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
<span class="gh">Out[8]: </span><span class="go">&#39;HELLO WORLD&#39;</span>

<span class="go"># some readline features cannot be supported, so we allow</span>
<span class="go"># &quot;verbatim&quot; blocks, which are dumped in verbatim except prompts</span>
<span class="go"># are continuously numbered</span>
<span class="gp">In [9]: </span><span class="n">x</span><span class="o">.</span><span class="n">st</span><span class="o">&lt;</span><span class="n">TAB</span><span class="o">&gt;</span>
<span class="go">x.startswith  x.strip</span>
</pre></div>
</div>
<p>Multi-line input is supported.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [10]: </span><span class="n">url</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;https://example.com?s=CROX&amp;d=9&amp;e=22&amp;f=2009&amp;&#39;</span>
<span class="gp">   ....: </span>       <span class="s1">&#39;g=d&amp;a=1&amp;br=8&amp;c=2006&amp;ignore=.csv&#39;</span><span class="p">)</span>
<span class="gp">   ....: </span>

<span class="gp">In [11]: </span><span class="nb">print</span><span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">))</span>
<span class="go">[&#39;https://example.com?s=CROX&#39;, &#39;d=9&#39;, &#39;e=22&#39;, &#39;f=2009&#39;, &#39;g=d&#39;, &#39;a=1&#39;, &#39;br=8&#39;, &#39;c=2006&#39;, &#39;ignore=.csv&#39;]</span>

<span class="gp">In [12]: </span><span class="kn">import</span> <span class="nn">urllib</span>
</pre></div>
</div>
<p>You can do doctesting on multi-line output as well.  Just be careful
when using non-deterministic inputs like random numbers in the IPython
directive, because your inputs are run through a live interpreter, so
if you are doctesting random output you will get an error.  Here we
“seed” the random number generator for deterministic output, and we
suppress the seed line so it doesn’t show up in the rendered output</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [13]: </span><span class="kn">import</span> <span class="nn">numpy.random</span>

<span class="gp">In [14]: </span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gh">Out[14]: </span><span class="go"></span>
<span class="go">array([[0.64524308, 0.59943846],</span>
<span class="go">       [0.47102322, 0.8715456 ],</span>
<span class="go">       [0.29370834, 0.74776844],</span>
<span class="go">       [0.99539577, 0.1313423 ],</span>
<span class="go">       [0.16250302, 0.21103583],</span>
<span class="go">       [0.81626524, 0.1312433 ],</span>
<span class="go">       [0.67338089, 0.72302393],</span>
<span class="go">       [0.7566368 , 0.07033696],</span>
<span class="go">       [0.22591016, 0.77731835],</span>
<span class="go">       [0.0072729 , 0.34273127]])</span>
</pre></div>
</div>
<p>Another demonstration of multi-line input and output</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [15]: </span><span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">hello world</span>

<span class="gp">In [16]: </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
<span class="gp">   ....: </span>    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="gp">   ....: </span>
<span class="go">0</span>
<span class="go">1</span>
<span class="go">2</span>
<span class="go">3</span>
<span class="go">4</span>
<span class="go">5</span>
<span class="go">6</span>
<span class="go">7</span>
<span class="go">8</span>
<span class="go">9</span>
</pre></div>
</div>
<p>Most of the “pseudo-decorators” can be used as options to IPython
mode.  For example, to setup <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> but suppress the output,
you can do.  This will not show up in the rendered docs, but the commands
will be executed in the embedded interpreter and subsequent line numbers
will be incremented to reflect the inputs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">..</span> <span class="n">ipython</span><span class="p">::</span>
   <span class="p">:</span><span class="n">suppress</span><span class="p">:</span>

   <span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

   <span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
</pre></div>
</div>
<p>Likewise, you can set the <code class="docutils literal notranslate"><span class="pre">:doctest:</span></code> or <code class="docutils literal notranslate"><span class="pre">:verbatim:</span></code> Sphinx options to
apply these settings to the entire block.  For example,</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [17]: </span><span class="n">cd</span> <span class="n">mpl</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span>
<span class="go">/home/jdhunter/mpl/examples</span>

<span class="gp">In [18]: </span><span class="n">pwd</span>
<span class="gh">Out[18]: </span><span class="go">&#39;/home/jdhunter/mpl/examples&#39;</span>

<span class="gp">In [19]: </span><span class="n">cd</span> <span class="n">mpl</span><span class="o">/</span><span class="n">examples</span><span class="o">/&lt;</span><span class="n">TAB</span><span class="o">&gt;</span>
<span class="go">mpl/examples/animation/        mpl/examples/misc/</span>
<span class="go">mpl/examples/api/              mpl/examples/mplot3d/</span>
<span class="go">mpl/examples/axes_grid/        mpl/examples/pylab_examples/</span>
<span class="go">mpl/examples/event_handling/   mpl/examples/widgets</span>

<span class="gp">In [20]: </span><span class="n">cd</span> <span class="n">mpl</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span><span class="n">widgets</span><span class="o">/</span>
<span class="go">/home/jdhunter/mpl/examples/widgets</span>

<span class="gp">In [21]: </span><span class="o">!</span>wc *
<span class="go">    2    12    77 README.txt</span>
<span class="go">   40    97   884 buttons.py</span>
<span class="go">   26    90   712 check_buttons.py</span>
<span class="go">   19    52   416 cursor.py</span>
<span class="go">  180   404  4882 menu.py</span>
<span class="go">   16    45   337 multicursor.py</span>
<span class="go">   36   106   916 radio_buttons.py</span>
<span class="go">   48   226  2082 rectangle_selector.py</span>
<span class="go">   43   118  1063 slider_demo.py</span>
<span class="go">   40   124  1088 span_selector.py</span>
<span class="go">  450  1274 12457 total</span>
</pre></div>
</div>
<p>You can create one or more plots and insert them with the
<code class="docutils literal notranslate"><span class="pre">&#64;savefig</span></code> decorator.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [22]: </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]);</span>

<span class="go"># use a semicolon to suppress the output</span>
<span class="gp">In [23]: </span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">10000</span><span class="p">),</span> <span class="mi">100</span><span class="p">);</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/plot_simple.png"><img alt="../_images/plot_simple.png" src="../_images/plot_simple.png" style="width: 4in;" /></a>
<a class="reference internal image-reference" href="../_images/hist_simple.png"><img alt="../_images/hist_simple.png" src="../_images/hist_simple.png" style="width: 4in;" /></a>
<p>In a subsequent session, we can update the current figure with some
text, and then resave</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [24]: </span><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;number&#39;</span><span class="p">)</span>
<span class="gh">Out[24]: </span><span class="go">Text(38.347222222222214, 0.5, &#39;number&#39;)</span>

<span class="gp">In [25]: </span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;normal distribution&#39;</span><span class="p">)</span>
<span class="gh">Out[25]: </span><span class="go">Text(0.5, 1.0, &#39;normal distribution&#39;)</span>

<span class="gp">In [26]: </span><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/hist_with_text.png"><img alt="../_images/hist_with_text.png" class="align-center" src="../_images/hist_with_text.png" style="width: 4in;" /></a>
<div class="section" id="pseudo-decorators">
<h2>Pseudo-Decorators<a class="headerlink" href="#pseudo-decorators" title="Permalink to this headline">¶</a></h2>
<p>Here are the supported decorators, and any optional arguments they
take.  Some of the decorators can be used as options to the entire
block (eg <code class="docutils literal notranslate"><span class="pre">verbatim</span></code> and <code class="docutils literal notranslate"><span class="pre">suppress</span></code>), and some only apply to the
line just below them (eg <code class="docutils literal notranslate"><span class="pre">savefig</span></code>).</p>
<p><code class="docutils literal notranslate"><span class="pre">&#64;suppress</span></code></p>
<blockquote>
<div><p>execute the IPython input block, but suppress the input and output
block from the rendered output.  Also, can be applied to the entire
<code class="docutils literal notranslate"><span class="pre">..ipython</span></code> block as a directive option with <code class="docutils literal notranslate"><span class="pre">:suppress:</span></code>.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">&#64;verbatim</span></code></p>
<blockquote>
<div><p>insert the input and output block in verbatim, but auto-increment
the line numbers. Internally, the interpreter will be fed an empty
string, so it is a no-op that keeps line numbering consistent.
Also, can be applied to the entire <code class="docutils literal notranslate"><span class="pre">..ipython</span></code> block as a
directive option with <code class="docutils literal notranslate"><span class="pre">:verbatim:</span></code>.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">&#64;savefig</span> <span class="pre">OUTFILE</span> <span class="pre">[IMAGE_OPTIONS]</span></code></p>
<blockquote>
<div><p>save the figure to the static directory and insert it into the
document, possibly binding it into a minipage and/or putting
code/figure label/references to associate the code and the
figure. Takes args to pass to the image directive (<em>scale</em>,
<em>width</em>, etc can be kwargs); see <a class="reference external" href="http://docutils.sourceforge.net/docs/ref/rst/directives.html#image">image options</a>
for details.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">&#64;doctest</span></code></p>
<blockquote>
<div><p>Compare the pasted in output in the IPython block with the output
generated at doc build time, and raise errors if they don’t
match. Also, can be applied to the entire <code class="docutils literal notranslate"><span class="pre">..ipython</span></code> block as a
directive option with <code class="docutils literal notranslate"><span class="pre">:doctest:</span></code>.</p>
</div></blockquote>
</div>
<div class="section" id="enabling-ipython-directive">
<h2>Enabling IPython Directive<a class="headerlink" href="#enabling-ipython-directive" title="Permalink to this headline">¶</a></h2>
<p>To enable the IPython directive(s) in your Sphinx documentation,
you’ll need to have <code class="docutils literal notranslate"><span class="pre">IPython</span></code> installed and include the following
in your Sphinx configuration (<code class="docutils literal notranslate"><span class="pre">conf.py</span></code>):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">extensions</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;IPython.sphinxext.ipython_directive&#39;</span><span class="p">,</span>
    <span class="s1">&#39;IPython.sphinxext.ipython_console_highlighting&#39;</span><span class="p">,</span>
    <span class="o">...</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="sphinx-source-for-this-tutorial">
<span id="ipython-literal"></span><h2>Sphinx source for this tutorial<a class="headerlink" href="#sphinx-source-for-this-tutorial" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>.. _ipython_directive:

=================
IPython Directive
=================

The IPython directive is a stateful IPython shell for embedding in
Sphinx documents.  It knows about standard IPython prompts, and
extracts the input and output lines.  These prompts will be renumbered
starting at ``1``.  The inputs will be fed to an embedded IPython
interpreter and the outputs from that interpreter will be inserted as
well.  For example, code blocks like the following::

  .. ipython::

     In [136]: x = 2

     In [137]: x**3
     Out[137]: 8

will be rendered as

.. ipython::

   In [136]: x = 2

   In [137]: x**3
   Out[137]: 8

.. note::

   This tutorial should be read side-by-side with the Sphinx source
   for this document (see :ref:`ipython_literal`) because otherwise
   you will see only the rendered output and not the code that
   generated it.  Excepting the example above, we will not in general
   be showing the literal reST in this document that generates the
   rendered output.


The state from previous sessions is stored, and standard error is
trapped.  At doc build time, IPython&#39;s output and std err will be
inserted, and prompts will be renumbered.  So the prompt below should
be renumbered in the rendered docs, and pick up where the block above
left off.

.. ipython::

  In [1]: z = x * 3  # x is recalled from previous block

  In [2]: z

  In [3]: print(z)

  In [4]: q = z

The embedded interpreter supports some limited markup.  For example,
you can put comments in your IPython sessions, which are reported
verbatim.  There are some handy &quot;pseudo-decorators&quot; that let you
doctest the output.  The inputs are fed to an embedded IPython
session and the outputs from the IPython session are inserted into
your doc.  If the output in your doc and in the IPython session don&#39;t
match on a doctest assertion, an error will be raised

.. ipython::

   In [1]: x = &#39;hello world&#39;

   # this will raise an error if the IPython output is different
   @doctest
   In [2]: x.upper()
   Out[2]: &#39;HELLO WORLD&#39;

   # some readline features cannot be supported, so we allow
   # &quot;verbatim&quot; blocks, which are dumped in verbatim except prompts
   # are continuously numbered
   @verbatim
   In [3]: x.st&lt;TAB&gt;
   x.startswith  x.strip

Multi-line input is supported.

.. ipython::

   In [1]: url = (&#39;https://example.com?s=CROX&amp;d=9&amp;e=22&amp;f=2009&amp;&#39;
      ...:        &#39;g=d&amp;a=1&amp;br=8&amp;c=2006&amp;ignore=.csv&#39;)
      ...:

   In [2]: print(url.split(&#39;&amp;&#39;))

   In [3]: import urllib

You can do doctesting on multi-line output as well.  Just be careful
when using non-deterministic inputs like random numbers in the IPython
directive, because your inputs are run through a live interpreter, so
if you are doctesting random output you will get an error.  Here we
&quot;seed&quot; the random number generator for deterministic output, and we
suppress the seed line so it doesn&#39;t show up in the rendered output

.. ipython::

   In [1]: import numpy.random

   @suppress
   In [2]: numpy.random.seed(2358)

   @doctest
   In [3]: numpy.random.rand(10, 2)
   Out[3]:
   array([[0.64524308, 0.59943846],
          [0.47102322, 0.8715456 ],
          [0.29370834, 0.74776844],
          [0.99539577, 0.1313423 ],
          [0.16250302, 0.21103583],
          [0.81626524, 0.1312433 ],
          [0.67338089, 0.72302393],
          [0.7566368 , 0.07033696],
          [0.22591016, 0.77731835],
          [0.0072729 , 0.34273127]])

Another demonstration of multi-line input and output

.. ipython::

   In [1]: print(x)

   In [2]: for i in range(10):
      ...:     print(i)
      ...:

Most of the &quot;pseudo-decorators&quot; can be used as options to IPython
mode.  For example, to setup ``matplotlib`` but suppress the output,
you can do.  This will not show up in the rendered docs, but the commands
will be executed in the embedded interpreter and subsequent line numbers
will be incremented to reflect the inputs::

  .. ipython::
     :suppress:

     In [1]: import matplotlib.pyplot as plt

     In [2]: plt.ion()

.. ipython::
   :suppress:

   In [1]: import matplotlib.pyplot as plt

   In [2]: plt.ion()

Likewise, you can set the ``:doctest:`` or ``:verbatim:`` Sphinx options to
apply these settings to the entire block.  For example,

.. ipython::
   :verbatim:

   In [1]: cd mpl/examples/
   /home/jdhunter/mpl/examples

   In [2]: pwd
   Out[2]: &#39;/home/jdhunter/mpl/examples&#39;

   In [3]: cd mpl/examples/&lt;TAB&gt;
   mpl/examples/animation/        mpl/examples/misc/
   mpl/examples/api/              mpl/examples/mplot3d/
   mpl/examples/axes_grid/        mpl/examples/pylab_examples/
   mpl/examples/event_handling/   mpl/examples/widgets

   In [4]: cd mpl/examples/widgets/
   /home/jdhunter/mpl/examples/widgets

   In [5]: !wc *
       2    12    77 README.txt
      40    97   884 buttons.py
      26    90   712 check_buttons.py
      19    52   416 cursor.py
     180   404  4882 menu.py
      16    45   337 multicursor.py
      36   106   916 radio_buttons.py
      48   226  2082 rectangle_selector.py
      43   118  1063 slider_demo.py
      40   124  1088 span_selector.py
     450  1274 12457 total

You can create one or more plots and insert them with the
``@savefig`` decorator.

.. ipython::

   @savefig plot_simple.png width=4in
   In [1]: plt.plot([1,2,3]);

   # use a semicolon to suppress the output
   @savefig hist_simple.png width=4in
   In [2]: plt.hist(np.random.randn(10000), 100);

In a subsequent session, we can update the current figure with some
text, and then resave

.. ipython::

   In [1]: plt.ylabel(&#39;number&#39;)

   In [2]: plt.title(&#39;normal distribution&#39;)

   @savefig hist_with_text.png width=4in align=center
   In [3]: plt.grid(True)

Pseudo-Decorators
=================

Here are the supported decorators, and any optional arguments they
take.  Some of the decorators can be used as options to the entire
block (eg ``verbatim`` and ``suppress``), and some only apply to the
line just below them (eg ``savefig``).

``@suppress``

    execute the IPython input block, but suppress the input and output
    block from the rendered output.  Also, can be applied to the entire
    ``..ipython`` block as a directive option with ``:suppress:``.

``@verbatim``

    insert the input and output block in verbatim, but auto-increment
    the line numbers. Internally, the interpreter will be fed an empty
    string, so it is a no-op that keeps line numbering consistent.
    Also, can be applied to the entire ``..ipython`` block as a
    directive option with ``:verbatim:``.

``@savefig OUTFILE [IMAGE_OPTIONS]``

    save the figure to the static directory and insert it into the
    document, possibly binding it into a minipage and/or putting
    code/figure label/references to associate the code and the
    figure. Takes args to pass to the image directive (*scale*,
    *width*, etc can be kwargs); see `image options
    &lt;http://docutils.sourceforge.net/docs/ref/rst/directives.html#image&gt;`_
    for details.

``@doctest``

    Compare the pasted in output in the IPython block with the output
    generated at doc build time, and raise errors if they don’t
    match. Also, can be applied to the entire ``..ipython`` block as a
    directive option with ``:doctest:``.

Enabling IPython Directive
==========================

To enable the IPython directive(s) in your Sphinx documentation,
you&#39;ll need to have ``IPython`` installed and include the following
in your Sphinx configuration (``conf.py``):

.. code-block:: python

   extensions = [
       &#39;IPython.sphinxext.ipython_directive&#39;,
       &#39;IPython.sphinxext.ipython_console_highlighting&#39;,
       ...
   ]

.. _ipython_literal:

Sphinx source for this tutorial
===============================

.. literalinclude:: ipython_directive.rst
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="cheatsheet.html" class="btn btn-neutral float-right" title="Sphinx cheat sheet" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="extensions.html" class="btn btn-neutral float-left" title="Sphinx extensions for embedded plots, math and more" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Patrick Brunswyck.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>